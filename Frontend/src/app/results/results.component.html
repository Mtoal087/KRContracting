<app-filters-modal
  *ngIf="isModalOpen"
  [filters]="filters"
  (filtersUpdated)="updateFilters($event)"
  (close)="closeModal()"
></app-filters-modal>

<!-- Apply and Reset Buttons -->
<div class="buttonFilter">
  <button class="button orange" (click)="openModal()">Open Filters<span></span></button>
  <button class="button red" (click)="resetFilters()">Reset<span></span></button>
</div>

<!-- Table -->
<div class="table" style="overflow-x: auto; white-space: nowrap">
  <table>
    <thead>
      <tr>
        <th (click)="sortData('CityName')">City Name</th>
        <th (click)="sortData('OwnersName')">Owner's Name</th>
        <th>Mailing Address</th>
        <th (click)="sortData('SchoolDistrict')">School District</th>
        <th (click)="sortData('LocatorNumber')">Locator Number</th>
        <th>Lot Dimensions</th>
        <th>Lot Number</th>
        <th (click)="sortData('PropertyClass')">Property Class</th>
        <th (click)="sortData('SiteCode')">Site Code</th>
        <th>Subdivision Name</th>
        <th (click)="sortData('TaxDistrict')">Tax District</th>
        <th (click)="sortData('NumberOfYearsWithUnpaidTaxes')">Number of Years With Unpaid Taxes</th>
        <th (click)="sortData('TotalInterest')">Total Interest</th>
        <th (click)="sortData('TotalPenalties')">Total Penalties</th>
        <th>Total Sewer Lateral Fee</th>
        <th (click)="sortData('TotalTaxes')">Total Taxes</th>
        <th (click)="sortData('TaxYear')">Tax Year</th>
        <th (click)="sortData('CityCode')">City Code</th>
        <th>Destination Code</th>
        <th>Taxing Address</th>
        <th>Care Of Name</th>
        <th>Legal Description</th>
        <th>Block Number</th>
        <th (click)="sortData('TotalAcres')">Total Acres</th>
        <th (click)="sortData('LandUseCode')">Land Use Code</th>
        <th>Tax Code Description</th>
        <th>Deed Document Number</th>
        <th>County Council District</th>
        <th (click)="sortData('AppraisedValue2024')">Appraised Value 2024</th>
        <th (click)="sortData('AssessedTotal2024')">Assessed Total 2024</th>
        <th (click)="sortData('TotalAmmountDue')">Total Amount Due</th>
        <th>On Post Thirds List</th>
        <th>Going On Post Thirds List</th>
        <th>Map Link</th>
        <th>Total Amount Due / Appraised Value 2024</th>
        <th>Total Amount Due / Assessed Total 2024</th>
        <th>Total Taxes + Total Sewer Lateral Fee</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of dataArray; trackBy: trackByFn">
        <td>{{ displayValue(item.CityName) }}</td>
        <td>{{ displayValue(item.OwnersName) }}</td>
        <td *ngIf="displayValue(item.MailingAddress) === 'Same as the taxing address.'; else otherAddress">
          {{ displayValue(item.TaxingAddress) }}
        </td>
        <ng-template #otherAddress>
          <td>{{ displayValue(item.MailingAddress) }}</td>
        </ng-template>
        <td>{{ displayValue(item.SchoolDistrict) }}</td>
        <td>{{ displayValue(item.LocatorNumber) }}</td>
        <td>{{ displayValue(item.LotDimensions) }}</td>
        <td>{{ displayValue(item.LotNumber) }}</td>
        <td>{{ displayValue(item.PropertyClass) }}</td>
        <td>{{ displayValue(item.SiteCode) }}</td>
        <td>{{ displayValue(item.SubdivisionName) }}</td>
        <td>{{ displayValue(item.TaxDistrict) }}</td>
        <td>{{ displayValue(item.NumberOfYearsWithUnpaidTaxes) }}</td>
        <td *ngIf="displayValue(item.TotalInterest) === 'None'; else otherTotalInterest">
          {{ displayValue(item.TotalInterest) }}
        </td>
        <ng-template #otherTotalInterest>
          <td>{{ '$' + displayValue(item.TotalInterest) }}</td>
        </ng-template>             
        <td *ngIf="displayValue(item.TotalPenalties) === 'None'; else otherTotalPenalties">
          {{ displayValue(item.TotalPenalties) }}
        </td>
        <ng-template #otherTotalPenalties>
          <td>{{ '$' + displayValue(item.TotalPenalties) }}</td>
        </ng-template>
        <td *ngIf="displayValue(item.TotalSewerLateralFee) === 'None'; else otherTotalSewerLateralFee">
          {{ displayValue(item.TotalSewerLateralFee) }}
        </td>
        <ng-template #otherTotalSewerLateralFee>
          <td>{{ '$' + displayValue(item.TotalSewerLateralFee) }}</td>
        </ng-template>
        <td *ngIf="displayValue(item.TotalTaxes) === 'None'; else otherTotalTaxes">
          {{ displayValue(item.TotalTaxes) }}
        </td>
        <ng-template #otherTotalTaxes>
          <td>{{ '$' + displayValue(item.TotalTaxes) }}</td>
        </ng-template>
        <td>{{ displayValue(item.TaxYear) }}</td>
        <td>{{ displayValue(item.CityCode) }}</td>
        <td>{{ displayValue(item.DestinationCode) }}</td>
        <td>{{ displayValue(item.TaxingAddress) }}</td>
        <td>{{ displayValue(item.CareOfName) }}</td>
        <td>{{ displayValue(item.LegalDescrition) }}</td>
        <td>{{ displayValue(item.BlockNumber) }}</td>
        <td>{{ displayValue(item.TotalAcres) }}</td>
        <td>{{ displayValue(item.LandUseCode) }}</td>
        <td>{{ displayValue(item.TaxCodeDescritpion) }}</td>
        <td>{{ displayValue(item.DeedDocumentNumber) }}</td>
        <td>{{ displayValue(item.CountyCouncilDistrict) }}</td>
        <td *ngIf="displayValue(item.AppraisedValue2024) === 'None'; else otherAppraisedValue2024">
          {{ displayValue(item.AppraisedValue2024) }}
        </td>
        <ng-template #otherAppraisedValue2024>
          <td>{{ '$' + displayValue(item.AppraisedValue2024) }}</td>
        </ng-template>
        <td *ngIf="displayValue(item.AssessedTotal2024) === 'None'; else otherAssessedTotal2024">
          {{ displayValue(item.AssessedTotal2024) }}
        </td>
        <ng-template #otherAssessedTotal2024>
          <td>{{ '$' + displayValue(item.AssessedTotal2024) }}</td>
        </ng-template>
        <td *ngIf="displayValue(item.TotalAmmountDue) === 'None'; else otherTotalAmmountDue">
          {{ displayValue(item.TotalAmmountDue) }}
        </td>
        <ng-template #otherTotalAmmountDue>
          <td>{{ '$' + displayValue(item.TotalAmmountDue) }}</td>
        </ng-template>
        <td>{{ displayValue(item.IsParcelOnPostThirdsList) }}</td>
        <td>{{ displayValue(item.IsGoingToBeOnPostThirdList) }}</td>
        <td>
          <a *ngIf="isLink(item.MapLink)" [href]="item.MapLink" target="_blank">
            Map Link
          </a>
          <span *ngIf="!isLink(item.MapLink)">None</span>
        </td>
        <td *ngIf="displayValue(item.TotalAmountDueOverAppraisedValue2024) === 'None'; else otherTotalAmountDueOverAppraisedValue2024">
          {{ displayValue(item.TotalAmountDueOverAppraisedValue2024) }}
        </td>
        <ng-template #otherTotalAmountDueOverAppraisedValue2024>
          <td>{{ '$' + displayValue(item.TotalAmountDueOverAppraisedValue2024) }}</td>
        </ng-template>
        <td *ngIf="displayValue(item.TotalAmountDueOverAssessedTotal2024) === 'None'; else otherTotalAmountDueOverAssessedTotal2024">
          {{ displayValue(item.TotalAmountDueOverAssessedTotal2024) }}
        </td>
        <ng-template #otherTotalAmountDueOverAssessedTotal2024>
          <td>{{ '$' + displayValue(item.TotalAmountDueOverAssessedTotal2024) }}</td>
        </ng-template>
        <td *ngIf="displayValue(item.TotalTaxesPlusTotalSewerLateralFee) === 'None'; else otherTotalTaxesPlusTotalSewerLateralFee">
          {{ displayValue(item.TotalTaxesPlusTotalSewerLateralFee) }}
        </td>
        <ng-template #otherTotalTaxesPlusTotalSewerLateralFee>
          <td>{{ '$' + displayValue(item.TotalTaxesPlusTotalSewerLateralFee) }}</td>
        </ng-template>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination Controls -->
<div class="pagination">
  <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
    Previous
  </button>

  <ng-container *ngFor="let page of getPages()">
    <button
      *ngIf="page !== '...'; else dots"
      (click)="goToPage(page)"
      [class.active]="currentPage === page"
    >
      {{ page }}
    </button>
    <ng-template #dots>
      <button (click)="goToPage(page)">
        {{ page }}
      </button>
    </ng-template>
  </ng-container>

  <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages()">
    Next
  </button>
</div>
